<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<link rel="stylesheet" href="style.css">
</head>
<body>
	

	<div class="settings">
		<div class="settings-element">
			<label for="color">Line color</label>
			<input type="color" id="color">	
		</div>
		<div class="settings-element">
			<label for="background">Background color</label>
			<input type="color" id="background" value="#ffffff">
		</div>	
		<div class="settings-element">		
			<label for="size">Size</label>
			<input type="number" id="size" value="5" min="1" max="99">	
		</div>
		<div class="settings-element">	
		<label for="check">Mirror effect</label>
		<input type="checkbox" id="check">
		<label for="check" id="checkbox"></label>	
		</div>
		<div class="settings-element">
			<button id="clear">Clear</button>
		</div>	
	</div>
	<canvas width="900" height="450" id="canvas"></canvas>
	<div class="buttons-container">
		<button class="buttons" id="increase">+</button>
		<button class="buttons" id="decrease">-</button>
		<button id="backward" class="buttons">Backward</button>
		<button id="forward" class="buttons">Forward</button>
		<button id="save" class="buttons">Save</button>
		<button id="load" class="buttons">Load</button>
		<span class="storage-text" id="saved"></span>
	</div>
	<script>
		var canvas= document.getElementById("canvas");
		var ctx = canvas.getContext("2d");
		var color = document.getElementById("color");
		var size = document.getElementById("size");
		var clear  =document.getElementById("clear");
		var arrCircles = [];
		var circlesDeleted = [];
		var backgroundColor = document.getElementById("background");
		var mirrorEffect = document.getElementById("check");
		var increase = document.getElementById("increase");
		var decrease = document.getElementById("decrease");
		var backward = document.getElementById("backward");
		var forward = document.getElementById("forward");
		var save = document.getElementById("save");
		var load = document.getElementById("load");	
		var localStorageText = document.getElementById("saved");
		ctx.strokeStyle = color.value;
		function toggle(elem, text){
			elem.innerHTML = text;
			elem.classList.add("storage-text-visible");
			setTimeout(function(){
                	elem.classList.remove("storage-text-visible");
                	elem.innerHTML = "";
                }, 2000);
		}	

		function Circle(x,y,color,size,scale, mirror) {
			this.x = x;
			this.y = y;
			this.color = color;
			this.size = size;
			this.scale = scale;
			this.mirror = mirror;
   			
   		this.draw  = function(){
       		ctx.beginPath();
        	ctx.arc(this.x,this.y,this.size*this.scale,0,2*Math.PI);
        	ctx.fillStyle=this.color;
        	ctx.fill();
        	if(this.mirror == true){
        		ctx.beginPath();
        		ctx.arc(canvas.width - this.x,this.y,this.size*this.scale,0,2*Math.PI);
        		ctx.fillStyle=this.color;
        		ctx.fill();
        		ctx.beginPath();
        		ctx.arc(this.x,canvas.height - this.y,this.size*this.scale,0,2*Math.PI);
        		ctx.fillStyle=this.color;
        		ctx.fill();
        		ctx.beginPath();
        		ctx.arc(canvas.width - this.x,canvas.height -this.y,this.size*this.scale,0,2*Math.PI);
        		ctx.fillStyle=this.color;
        		ctx.fill();
        	}
    	}
    		arrCircles.push(this);
   		 }
   		canvas.onmousemove = function(evt){
   		/*mouse position*/
   			var rect = canvas.getBoundingClientRect();
			var x = event.clientX - rect.left;
			var y = event.clientY - rect.top;

    		if (evt.buttons) {
    			circlesDeleted = [];
    			var circle = new Circle(x, y,color.value, size.value,1,mirrorEffect.checked);
        		circle.draw();  	 
    		}
		}
	backgroundColor.onchange = function(){
		canvas.style.backgroundColor = backgroundColor.value;
					}

	clear.onclick = function(){
		ctx.clearRect(0,0,canvas.width,canvas.height);
		arrCircles = [];
		circlesDeleted = [];
	}

	backward.onclick = function(){
		ctx.clearRect(0,0,canvas.width,canvas.height);

		var a = arrCircles.length;

		circlesDeleted.push(arrCircles[a-1]);
		arrCircles.pop();

		for(var i = 0;i < arrCircles.length; i++){
			arrCircles[i].draw();
		}
	}
	forward.onclick = function(){
		if(circlesDeleted.length > 0){
			ctx.clearRect(0,0,canvas.width,canvas.height);

			var a = circlesDeleted.length;

			arrCircles.push(circlesDeleted[a-1]);
			circlesDeleted.pop();

			for(var i = 0;i < arrCircles.length; i++){
				arrCircles[i].draw();
			}
		}
	}
	increase.onclick = function(){			
		ctx.clearRect(0,0,canvas.width,canvas.height);

		for(var i = 0;i < arrCircles.length; i++){
			arrCircles[i].scale += 0.5;
			arrCircles[i].draw();
		}		
	}
	decrease.onclick = function(){			
		ctx.clearRect(0,0,canvas.width,canvas.height);
		for(var i = 0;i < arrCircles.length; i++){
			if(arrCircles[i].scale >= 1.5){
				arrCircles[i].scale -= 0.5;
				arrCircles[i].draw();
			}
			else{
				arrCircles[i].draw();
			}	
		}
	}
	save.onclick = function(){
		if(arrCircles.length > 0){
			toggle(localStorageText, "Saved!");

			var b = localStorage.setItem("Circle",JSON.stringify(arrCircles));
		}
		else{
			toggle(localStorageText, "Nothing to save");
		}
	}
	load.onclick = function(){
		var a = (JSON.parse(localStorage.getItem("Circle")));
		if(localStorage.length > 0){
			for(var i = 0;i < a.length; i++){
				var circle = new Circle(a[i].x, a[i].y, a[i].color, a[i].size , a[i].scale, a[i].mirror);
				arrCircles.push(circle);
			}
			for(var b = 0; b < arrCircles.length; b++){
				arrCircles[b].draw();
				toggle(localStorageText, "Loaded!");	
			}	
		}
		else{
			toggle(localStorageText, "Nothing to load");
		}
		localStorage.clear();
			
	}
	</script>
</body>
</html>